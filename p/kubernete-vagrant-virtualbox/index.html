<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Creating Your Own Cluster with Vagrant and VirtualBox"><title>Kubernetes on Vagrant and VirtualBox: Quick Setup</title>
<link rel=canonical href=https://m-dhia.github.io/p/kubernete-vagrant-virtualbox/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="Kubernetes on Vagrant and VirtualBox: Quick Setup"><meta property="og:description" content="Creating Your Own Cluster with Vagrant and VirtualBox"><meta property="og:url" content="https://m-dhia.github.io/p/kubernete-vagrant-virtualbox/"><meta property="og:site_name" content="m-dhia"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="DevOps"><meta property="article:tag" content="K8S"><meta property="article:tag" content="VirtualBox"><meta property="article:tag" content="Vagrant"><meta property="article:published_time" content="2024-01-04T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-04T00:00:00+00:00"><meta property="og:image" content="https://m-dhia.github.io/p/kubernete-vagrant-virtualbox/Pictures/cover.webp"><meta name=twitter:title content="Kubernetes on Vagrant and VirtualBox: Quick Setup"><meta name=twitter:description content="Creating Your Own Cluster with Vagrant and VirtualBox"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://m-dhia.github.io/p/kubernete-vagrant-virtualbox/Pictures/cover.webp"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu520ea9966ba9413480a593471c2143c7_202403_300x0_resize_box_3.png width=300 height=275 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>☁️</span></figure><div class=site-meta><h1 class=site-name><a href=/>m-dhia</a></h1><h2 class=site-description>Embrace the journey.</h2></div></header><ol class=social-menu><li><a href=https://github.com/m-dhia target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/resume/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-book-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19 4v16H7a2 2 0 01-2-2V6a2 2 0 012-2h12z"/><path d="M19 16H7a2 2 0 00-2 2"/><path d="M9 8h6"/></svg>
<span>Resume</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#benefits-of-local-implementation>Benefits of Local Implementation</a></li><li><a href=#implementation>Implementation</a><ol><li><a href=#cloning-the-repository>Cloning the repository</a></li><li><a href=#vagrant>Vagrant</a><ol><li><a href=#starting-vagrant-environment>Starting Vagrant Environment</a></li><li><a href=#ssh-into-vagrant-master-node>SSH into Vagrant Master Node</a></li><li><a href=#check-kubernetes-nodes-status>Check Kubernetes Nodes Status</a></li></ol></li></ol></li><li><a href=#code-explanation>Code Explanation</a><ol><li><a href=#vagrantfile>Vagrantfile</a><ol><li><a href=#vagrant-configuration-version-and-block>Vagrant Configuration Version and Block</a></li><li><a href=#master-node-configuration>Master Node Configuration</a></li><li><a href=#worker-node-configuration-loop>Worker Node Configuration Loop</a></li></ol></li><li><a href=#install_kubernetessh>install_kubernetes.sh</a><ol><li><a href=#updating-and-installing-packages>Updating and Installing Packages</a></li><li><a href=#installing-ansible-and-git>Installing Ansible and Git</a></li><li><a href=#ansible-playbook-execution>Ansible Playbook Execution</a></li><li><a href=#final-steps-and-outputs>Final Steps and Outputs</a></li></ol></li><li><a href=#rolerequirementsyml>role/requirements.yml</a><ol><li><a href=#install-a-role-for-pip>Install a Role for Pip</a></li><li><a href=#install-a-role-for-pip-1>Install a Role for Pip</a></li><li><a href=#install-kubernetes>Install Kubernetes</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/kubernete-vagrant-virtualbox/><img src=/p/kubernete-vagrant-virtualbox/Pictures/cover_hu7808d27d2c1e6ab8006edef16b60e26e_31344_800x0_resize_q75_h2_box_2.webp srcset="/p/kubernete-vagrant-virtualbox/Pictures/cover_hu7808d27d2c1e6ab8006edef16b60e26e_31344_800x0_resize_q75_h2_box_2.webp 800w, /p/kubernete-vagrant-virtualbox/Pictures/cover_hu7808d27d2c1e6ab8006edef16b60e26e_31344_1600x0_resize_q75_h2_box_2.webp 1600w" width=800 height=267 loading=lazy alt="Featured image of post Kubernetes on Vagrant and VirtualBox: Quick Setup"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/kubernete-vagrant-virtualbox/>Kubernetes on Vagrant and VirtualBox: Quick Setup</a></h2><h3 class=article-subtitle>Creating Your Own Cluster with Vagrant and VirtualBox</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 04, 2024</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>6 minute read</time></div></footer></div></header><section class=article-content><p>I am working with the <a class=link href=https://github.com/eazytraining/kubernetes-certification-stack target=_blank rel=noopener>kubernetes-certification-stack</a> repository owned by <a class=link href=https://github.com/eazytraining target=_blank rel=noopener>eazytraining</a>.</p><h2 id=benefits-of-local-implementation>Benefits of Local Implementation</h2><p>Setting up a Kubernetes cluster with Vagrant and VirtualBox, using a master and worker node configuration, can be beneficial for several reasons:</p><ul><li><strong>Learning and Development Environment:</strong> Using Vagrant and VirtualBox allows you to quickly set up a local environment that mirrors a production Kubernetes cluster. This can be useful for learning Kubernetes concepts, testing configurations, and developing applications that will eventually run on a production Kubernetes cluster.</li><li><strong>Isolation and Portability:</strong> Vagrant provides a way to manage virtual machine configurations as code, allowing you to define the entire cluster setup in a version-controlled configuration file. VirtualBox provides the virtualization platform, ensuring that the cluster runs in isolated environments that can be easily replicated across different machines.</li><li><strong>Integration Testing:</strong> With a local Kubernetes cluster, you can easily perform integration tests for your applications without affecting a production environment. This can be especially useful for testing how your applications interact with Kubernetes features like networking, storage, and security.</li></ul><h2 id=implementation>Implementation</h2><h3 id=cloning-the-repository>Cloning the repository</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>git clone https://github.com/eazytraining/kubernetes-certification-stack.git
</span></span><span class=line><span class=cl><span class=nb>cd</span> kubernetes-certification-stack
</span></span></code></pre></td></tr></table></div></div><h3 id=vagrant>Vagrant</h3><h4 id=starting-vagrant-environment>Starting Vagrant Environment</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vagrant up
</span></span></code></pre></td></tr></table></div></div><h5 id=troubleshooting-tips>Troubleshooting tips</h5><ul><li>For best results, use these scripts with a stable internet connection.</li><li>Even if it appears that the process is stalled, avoid canceling it.</li><li>If the process is canceled or interrupted, delete the virtual machines and rerun the Vagrantfile.</li><li>If you encounter the IP address configuration error depicted in the image below, create a new file at <code>/etc/vbox/networks.conf</code> and add the following lines to it:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>* 10.0.0.0/8 192.168.0.0/16
</span></span><span class=line><span class=cl>* 2001::/64
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/kubernete-vagrant-virtualbox/Pictures/ip-error.png width=811 height=208 srcset="/p/kubernete-vagrant-virtualbox/Pictures/ip-error_hude566a48c076cda5ecd4e66188b3e862_10342_480x0_resize_box_3.png 480w, /p/kubernete-vagrant-virtualbox/Pictures/ip-error_hude566a48c076cda5ecd4e66188b3e862_10342_1024x0_resize_box_3.png 1024w" loading=lazy alt=IP-configuration-error class=gallery-image data-flex-grow=389 data-flex-basis=935px></p><h4 id=ssh-into-vagrant-master-node>SSH into Vagrant Master Node</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>vagrant ssh master
</span></span></code></pre></td></tr></table></div></div><h4 id=check-kubernetes-nodes-status>Check Kubernetes Nodes Status</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo  kubectl get nodes
</span></span></code></pre></td></tr></table></div></div><p><img src=/p/kubernete-vagrant-virtualbox/Pictures/check-nodes.webp width=1920 height=1080 srcset="/p/kubernete-vagrant-virtualbox/Pictures/check-nodes_hufa60634cf9048f57efdf3bcfb24a8dd3_88736_480x0_resize_q75_h2_box_2.webp 480w, /p/kubernete-vagrant-virtualbox/Pictures/check-nodes_hufa60634cf9048f57efdf3bcfb24a8dd3_88736_1024x0_resize_q75_h2_box_2.webp 1024w" loading=lazy alt=Checking-nodes class=gallery-image data-flex-grow=177 data-flex-basis=426px></p><h2 id=code-explanation>Code Explanation</h2><h3 id=vagrantfile>Vagrantfile</h3><p>This Vagrantfile sets up a multi-node Kubernetes cluster with one master node and one worker node. Each node is configured with a base box (<em>geerlingguy/centos7</em>), a static IP address, hostname, memory, CPU, and provisioned with a shell script for installing Kubernetes.</p><h4 id=vagrant-configuration-version-and-block>Vagrant Configuration Version and Block</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=no>Vagrant</span><span class=o>.</span><span class=n>configure</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>)</span> <span class=k>do</span> <span class=o>|</span><span class=n>config</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=c1># ...</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><p>The <code>Vagrant.configure</code> method specifies the Vagrant configuration version.</p><h4 id=master-node-configuration>Master Node Configuration</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>config</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>define</span> <span class=s2>&#34;master&#34;</span> <span class=k>do</span> <span class=o>|</span><span class=n>master</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=n>master</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>box</span> <span class=o>=</span> <span class=s2>&#34;geerlingguy/centos7&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>master</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>network</span> <span class=s2>&#34;private_network&#34;</span><span class=p>,</span> <span class=ss>type</span><span class=p>:</span> <span class=s2>&#34;static&#34;</span><span class=p>,</span> <span class=ss>ip</span><span class=p>:</span> <span class=s2>&#34;192.168.99.10&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>master</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>hostname</span> <span class=o>=</span> <span class=s2>&#34;master&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>master</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>provider</span> <span class=s2>&#34;virtualbox&#34;</span> <span class=k>do</span> <span class=o>|</span><span class=n>v</span><span class=o>|</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;master&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=o>.</span><span class=n>memory</span> <span class=o>=</span> <span class=mi>2048</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=o>.</span><span class=n>cpus</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl>  <span class=n>master</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>provision</span> <span class=ss>:shell</span> <span class=k>do</span> <span class=o>|</span><span class=n>shell</span><span class=o>|</span>
</span></span><span class=line><span class=cl>    <span class=n>shell</span><span class=o>.</span><span class=n>path</span> <span class=o>=</span> <span class=s2>&#34;install_kubernetes.sh&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>shell</span><span class=o>.</span><span class=n>args</span> <span class=o>=</span> <span class=o>[</span><span class=s2>&#34;master&#34;</span><span class=p>,</span> <span class=s2>&#34;192.168.99.10&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>The <code>config.vm.define</code> block defines a virtual machine named &ldquo;master&rdquo; with specific configurations.</li><li>It specifies the base box to use (<em>geerlingguy/centos7</em>), sets up a private static IP address (192.168.99.10), and assigns the hostname &ldquo;master&rdquo;.</li><li>The <code>config.vm.provider</code> block configures the virtual machine provider (in this case, VirtualBox) settings such as name, memory (2048 MB), and CPUs (2).</li><li>The <code>config.vm.provision</code> block specifies provisioning using a shell script (<code>install_kubernetes.sh</code>) with arguments &ldquo;master&rdquo; and &ldquo;192.168.99.10&rdquo;.</li></ul><h4 id=worker-node-configuration-loop>Worker Node Configuration Loop</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>workers</span><span class=o>=</span><span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=n>ram_worker</span><span class=o>=</span><span class=mi>2048</span>
</span></span><span class=line><span class=cl><span class=n>cpu_worker</span><span class=o>=</span><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=mi>1</span><span class=o>..</span><span class=n>workers</span><span class=p>)</span><span class=o>.</span><span class=n>each</span> <span class=k>do</span> <span class=o>|</span><span class=n>i</span><span class=o>|</span>
</span></span><span class=line><span class=cl>  <span class=n>config</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>define</span> <span class=s2>&#34;worker</span><span class=si>#{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>do</span> <span class=o>|</span><span class=n>worker</span><span class=o>|</span>
</span></span><span class=line><span class=cl>    <span class=n>worker</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>box</span> <span class=o>=</span> <span class=s2>&#34;geerlingguy/centos7&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>worker</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>network</span> <span class=s2>&#34;private_network&#34;</span><span class=p>,</span> <span class=ss>type</span><span class=p>:</span> <span class=s2>&#34;static&#34;</span><span class=p>,</span> <span class=ss>ip</span><span class=p>:</span> <span class=s2>&#34;192.168.99.1</span><span class=si>#{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>worker</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>hostname</span> <span class=o>=</span> <span class=s2>&#34;worker</span><span class=si>#{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>worker</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>provider</span> <span class=s2>&#34;virtualbox&#34;</span> <span class=k>do</span> <span class=o>|</span><span class=n>v</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=n>v</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;worker</span><span class=si>#{</span><span class=n>i</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=n>v</span><span class=o>.</span><span class=n>memory</span> <span class=o>=</span> <span class=n>ram_worker</span>
</span></span><span class=line><span class=cl>      <span class=n>v</span><span class=o>.</span><span class=n>cpus</span> <span class=o>=</span> <span class=n>cpu_worker</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>    <span class=n>worker</span><span class=o>.</span><span class=n>vm</span><span class=o>.</span><span class=n>provision</span> <span class=ss>:shell</span> <span class=k>do</span> <span class=o>|</span><span class=n>shell</span><span class=o>|</span>
</span></span><span class=line><span class=cl>      <span class=n>shell</span><span class=o>.</span><span class=n>path</span> <span class=o>=</span> <span class=s2>&#34;install_kubernetes.sh&#34;</span>
</span></span><span class=line><span class=cl>      <span class=n>shell</span><span class=o>.</span><span class=n>args</span> <span class=o>=</span> <span class=o>[</span><span class=s2>&#34;node&#34;</span><span class=p>,</span> <span class=s2>&#34;192.168.99.10&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=k>end</span>
</span></span><span class=line><span class=cl>  <span class=k>end</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>This block sets up a loop to define worker nodes based on the <code>workers</code>, <code>ram_worker</code>, and <code>cpu_worker</code> variables.</li><li>Inside the loop, each worker node is defined with similar configurations as the master node, except for the specific IP address, hostname, and name.</li></ul><h3 id=install_kubernetessh>install_kubernetes.sh</h3><p>This script automates the setup process for a Kubernetes environment using Ansible, including installing necessary packages, and executing Ansible playbooks based on the type of node (master or worker). It also provides informative messages about the setup process and the IP address to be used for the stack.</p><h4 id=updating-and-installing-packages>Updating and Installing Packages</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>yum -y update
</span></span><span class=line><span class=cl>yum -y install epel-release
</span></span></code></pre></td></tr></table></div></div><ul><li>The script starts with the shebang line <code>#!/bin/bash</code> to indicate that it should be executed by the Bash shell.</li><li>It then updates the system (<code>yum -y update</code>) and installs the epel-release package, which provides additional packages for CentOS/RHEL.</li></ul><h4 id=installing-ansible-and-git>Installing Ansible and Git</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># install ansible</span>
</span></span><span class=line><span class=cl>yum -y install ansible
</span></span><span class=line><span class=cl><span class=c1># retrieve ansible code</span>
</span></span><span class=line><span class=cl>yum -y install git
</span></span></code></pre></td></tr></table></div></div><ul><li>This part installs Ansible (<code>yum -y install ansible</code>) and Git (<code>yum -y install git</code>) on the system, which are used for configuration management and version control, respectively.</li></ul><h4 id=ansible-playbook-execution>Ansible Playbook Execution</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>KUBERNETES_VERSION</span><span class=o>=</span>1.28.1
</span></span><span class=line><span class=cl>ansible-galaxy install -r roles/requirements.yml
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> <span class=nv>$1</span> <span class=o>==</span> <span class=s2>&#34;master&#34;</span> <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=c1># ...</span>
</span></span><span class=line><span class=cl><span class=k>fi</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>This part sets the variable <code>KUBERNETES_VERSION</code> to <code>1.28.1</code> and installs Ansible roles defined in <code>roles/requirements.yml</code> using <code>ansible-galaxy install -r roles/requirements.yml</code>.</li></ul><blockquote><p>The <code>ansible</code> command runs Ansible playbooks, which are YAML files with tasks for remote hosts, while <code>ansible-galaxy</code> allows users to search, install, and manage roles from the Ansible Galaxy community or their own private repositories.</p></blockquote><ul><li>It then checks the value of the first argument passed to the script (<code>$1</code>). If it is equal to &ldquo;master&rdquo;, it executes an Ansible playbook for setting up a Kubernetes master node. Otherwise, it executes an Ansible playbook for setting up a worker node.</li></ul><h4 id=final-steps-and-outputs>Final Steps and Outputs</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ...</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;For this Stack, you will use </span><span class=k>$(</span>ip -f inet addr show enp0s8 <span class=p>|</span> sed -En -e <span class=s1>&#39;s/.*inet ([0-9.]+).*/\1/p&#39;</span><span class=k>)</span><span class=s2> IP Address&#34;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>Depending on whether the node is a master or worker, the script executes different steps related to Kubernetes setup.</li><li>Finally, it outputs a message indicating the IP address to be used for the stack, based on the network interface <code>enp0s8</code>.</li></ul><h3 id=rolerequirementsyml>role/requirements.yml</h3><p>This YAML file define the dependencies or roles required for setting up a Kubernetes environment using Ansible. Each role is specified with its source (src) and version (version). When this file is used with Ansible, it instructs Ansible to download and install these roles from the specified sources (e.g., Ansible Galaxy) before executing the main playbook that uses these roles.</p><h4 id=install-a-role-for-pip>Install a Role for Pip</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>src</span><span class=p>:</span><span class=w> </span><span class=l>geerlingguy.pip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2.2.0&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>This block specifies the installation of the <code>geerlingguy.pip</code> role from Ansible Galaxy.</li><li>The <code>src</code> key specifies the source of the role (geerlingguy.pip).</li><li>The <code>version</code> key specifies the version of the role to install (in this case, version &ldquo;2.2.0&rdquo;).</li></ul><h4 id=install-a-role-for-pip-1>Install a Role for Pip</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>src</span><span class=p>:</span><span class=w> </span><span class=l>geerlingguy.containerd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;1.3.1&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>This block specifies the installation of the <code>geerlingguy.containerd</code> role from Ansible Galaxy.</li><li>The src key specifies the source of the role (<em>geerlingguy.containerd</em>).</li><li>The <code>version</code> key specifies the version of the role to install (in this case, version &ldquo;1.3.1&rdquo;).</li></ul><h4 id=install-kubernetes>Install Kubernetes</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>src</span><span class=p>:</span><span class=w> </span><span class=l>geerlingguy.kubernetes</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;7.1.2&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><ul><li>This block specifies the installation of the <code>geerlingguy.kubernetes</code> role from Ansible Galaxy.</li><li>The <code>src</code> key specifies the source of the role (geerlingguy.kubernetes).</li><li>The <code>version</code> key specifies the version of the role to install (in this case, version &ldquo;7.1.2&rdquo;).</li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/devops/>DevOps</a>
<a href=/tags/k8s/>K8S</a>
<a href=/tags/virtualbox/>VirtualBox</a>
<a href=/tags/vagrant/>Vagrant</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 m-dhia</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>